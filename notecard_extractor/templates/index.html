<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notecard Extractor - File Browser</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“„ Recipe Scanner</h1>
            <p>Manage your recipe collection</p>
        </div>

        <div class="tabs">
            <div class="tab" data-tab="upload">ðŸ“¤ Upload</div>
            <div class="tab active" data-tab="view">ðŸ“œ Recipes</div>
        </div>

        <!-- Upload Tab -->
        <div id="upload-tab" class="tab-content">
            <div class="folder-selector">
                <label for="pdfInput">Select PDF Files:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="pdfInput" accept=".pdf" multiple>
                    <div class="file-input-button">ðŸ“„ Choose PDF Files</div>
                </div>
                <div id="selectedFiles" class="selected-folder" style="display: none;">
                    <strong>Selected:</strong> <span id="fileCountText"></span>
                </div>
                <button id="uploadButton" class="file-input-button" style="margin-top: 15px; display: none;">
                    Upload to Database
                </button>
            </div>

            <div id="errorMessage" class="error" style="display: none;"></div>

            <div id="progressContainer" class="progress-container">
                <div class="progress-bar-wrapper">
                    <div id="progressBar" class="progress-bar">0%</div>
                </div>
                <div id="progressText" class="progress-text">Preparing upload...</div>
            </div>

            <div class="files-section">
                <div class="files-header">
                    <h2>Selected Files</h2>
                    <div id="fileCount" class="file-count" style="display: none;">0 files</div>
                </div>

                <div id="loading" class="loading" style="display: none;">
                    Uploading files...
                </div>

                <div id="filesList" class="files-list" style="display: none;">
                    <!-- Files will be inserted here -->
                </div>

                <div id="uploadResults" class="files-list" style="display: none; margin-top: 20px;">
                    <h3 style="padding: 15px 20px; background: #f0f0f0; margin: 0;">Upload Results</h3>
                    <!-- Upload results will be inserted here -->
                </div>

                <div id="emptyState" class="empty-state">
                    <div class="empty-state-icon">ðŸ“„</div>
                    <p>No PDF files selected. Please select PDF files to upload.</p>
                </div>
            </div>
        </div>

        <!-- View Tab -->
        <div id="view-tab" class="tab-content active">
            <div class="files-header">
                <h2>Uploaded Recipes</h2>
                <div id="recipeCount" class="file-count" style="display: none;">0 Recipes</div>
            </div>

            <div class="filters-container">
                <div class="filter-section">
                    <label for="recipeFilter" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Filter by Title:</label>
                    <input type="text" id="recipeFilter" placeholder="Type to filter recipes by title..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                </div>

                <div class="tag-filter-container">
                    <div class="tag-filter-header">
                        <span class="tag-filter-title">Filter by Tags:</span>
                        <div class="tag-filter-buttons">
                            <button class="tag-filter-btn" id="selectAllTagsBtn">All</button>
                            <button class="tag-filter-btn" id="deselectAllTagsBtn">Untagged</button>
                        </div>
                    </div>
                    <button class="tag-filter-toggle" id="tagFilterToggle">Select tags to filter...</button>
                    <div class="tag-filter-dropdown" id="tagFilterDropdown">
                        <!-- Tags will be loaded here -->
                    </div>
                </div>

                <div class="tag-filter-container">
                    <div class="tag-filter-header">
                        <span class="tag-filter-title">Filter by State:</span>
                        <div class="tag-filter-buttons">
                            <button class="tag-filter-btn" id="selectAllStatesBtn">All</button>
                            <button class="tag-filter-btn" id="deselectAllStatesBtn">None</button>
                        </div>
                    </div>
                    <button class="tag-filter-toggle" id="stateFilterToggle">Select states to filter...</button>
                    <div class="tag-filter-dropdown" id="stateFilterDropdown">
                        <!-- States will be loaded here -->
                    </div>
                </div>
            </div>

            <div id="viewLoading" class="loading" style="display: none;">
                Loading recipes...
            </div>

            <div id="viewError" class="error" style="display: none;"></div>

            <div id="recipesTableContainer" style="display: none;">
                <!-- Top Pagination Controls -->
                <div id="paginationTop" class="pagination-controls" style="display: none;">
                    <div class="pagination-left">
                        <label for="pageSizeSelect" style="color: #666; font-size: 0.95em;">Items per page:</label>
                        <select id="pageSizeSelect" class="pagination-select">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span id="paginationInfoTop" class="pagination-info"></span>
                    </div>
                    <div class="pagination-right">
                        <button id="firstPageBtn" class="pagination-button" title="First page">Â«Â«</button>
                        <button id="prevPageBtn" class="pagination-button" title="Previous page">â€¹</button>
                        <div class="pagination-jump">
                            <span style="color: #666; font-size: 0.95em;">Page:</span>
                            <input type="number" id="pageJumpInput" min="1" value="1" style="width: 60px;">
                            <span id="totalPagesSpan" style="color: #666; font-size: 0.95em;">of 1</span>
                            <button id="pageJumpBtn">Go</button>
                        </div>
                        <button id="nextPageBtn" class="pagination-button" title="Next page">â€º</button>
                        <button id="lastPageBtn" class="pagination-button" title="Last page">Â»Â»</button>
                    </div>
                </div>

                <table class="recipes-table">
                    <thead>
                        <tr>
                            <th class="count-column">#</th>
                            <th class="thumbnail-column">Images</th>
                            <th class="timestamp-column">Upload Date/Time</th>
                            <th class="filename-column">Title/PDF Filename</th>
                            <th class="state-column">State</th>
                            <th class="edit-column">Edit</th>
                            <th class="admin-column">Admin</th>
                        </tr>
                    </thead>
                    <tbody id="recipesTableBody">
                        <!-- Recipes will be inserted here -->
                    </tbody>
                </table>

                <!-- Bottom Pagination Controls -->
                <div id="paginationBottom" class="pagination-controls" style="display: none;">
                    <div class="pagination-left">
                        <label for="pageSizeSelectBottom" style="color: #666; font-size: 0.95em;">Items per page:</label>
                        <select id="pageSizeSelectBottom" class="pagination-select">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span id="paginationInfoBottom" class="pagination-info"></span>
                    </div>
                    <div class="pagination-right">
                        <button id="firstPageBtnBottom" class="pagination-button" title="First page">Â«Â«</button>
                        <button id="prevPageBtnBottom" class="pagination-button" title="Previous page">â€¹</button>
                        <div class="pagination-jump">
                            <span style="color: #666; font-size: 0.95em;">Page:</span>
                            <input type="number" id="pageJumpInputBottom" min="1" value="1" style="width: 60px;">
                            <span id="totalPagesSpanBottom" style="color: #666; font-size: 0.95em;">of 1</span>
                            <button id="pageJumpBtnBottom">Go</button>
                        </div>
                        <button id="nextPageBtnBottom" class="pagination-button" title="Next page">â€º</button>
                        <button id="lastPageBtnBottom" class="pagination-button" title="Last page">Â»Â»</button>
                    </div>
                </div>
            </div>

            <div id="viewEmptyState" class="empty-state">
                <div class="empty-state-icon">ðŸ“„</div>
                <p>No recipes uploaded yet. Use the Upload tab to add recipes to the database.</p>
            </div>
        </div>

        <!-- Edit Recipe Modal -->
        <div id="editModal" class="edit-modal">
            <div class="edit-modal-content">
                <div class="edit-modal-image-section">
                    <div class="edit-modal-image-container" id="editModalImageContainer">
                        <div class="edit-modal-image-nav edit-modal-image-nav-left" id="editModalNavLeft" style="display: none;">â€¹</div>
                        <img id="editModalImage" src="" alt="Recipe Image" style="display: none;">
                        <div class="edit-modal-image-nav edit-modal-image-nav-right" id="editModalNavRight" style="display: none;">â€º</div>
                        <div class="edit-modal-image-controls" id="editModalImageControls" style="display: none;">
                            <div class="edit-modal-rotate-btn" id="editModalRotateCCW" title="Rotate counter-clockwise">â†¶</div>
                            <div class="edit-modal-rotate-display" id="editModalRotationDisplay">0Â°</div>
                            <div class="edit-modal-rotate-btn" id="editModalRotateCW" title="Rotate clockwise">â†·</div>
                            <div class="edit-modal-unneeded-checkbox-wrapper">
                                <input type="checkbox" id="editModalUnneededCheckbox" class="edit-modal-unneeded-checkbox" title="Mark image as unneeded">
                                <label for="editModalUnneededCheckbox" class="edit-modal-unneeded-checkbox-label">Unneeded</label>
                            </div>
                        </div>
                    </div>
                    <div id="editModalImagePlaceholder" style="color: #999; text-align: center;">Loading image...</div>
                </div>
                <div class="edit-modal-form-section">
                    <div class="edit-modal-header">
                        <h2 class="edit-modal-title" id="editModalTitle">Edit Recipe</h2>
                        <button class="edit-modal-close" id="editModalClose">Ã—</button>
                    </div>
                    <form id="editRecipeForm" class="edit-form-grid">
                        <!-- Form fields will be populated dynamically -->
                    </form>
                </div>
            </div>
        </div>

        <!-- Image Preview Overlay -->
        <div id="imageOverlay" class="image-overlay">
            <div class="image-overlay-content">
                <div class="image-overlay-close" id="imageOverlayClose">Ã—</div>
                <div class="image-overlay-title" id="imageOverlayTitle"></div>
                <div class="image-nav-arrow image-nav-left" id="imageNavLeft" style="display: none;">â€¹</div>
                <img id="previewImage" src="" alt="Recipe Preview">
                <div class="image-nav-arrow image-nav-right" id="imageNavRight" style="display: none;">â€º</div>
                <div class="rotation-controls">
                    <div class="rotation-button" id="rotateCounterClockwise" title="Rotate counter-clockwise">â†¶</div>
                    <div class="rotation-display" id="rotationDisplay">0Â°</div>
                    <div class="rotation-button" id="rotateClockwise" title="Rotate clockwise">â†·</div>
                    <div class="unneeded-checkbox-wrapper">
                        <input type="checkbox" id="unneededCheckbox" class="unneeded-checkbox" title="Mark image as unneeded" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
                        <label for="unneededCheckbox" class="unneeded-checkbox-label">Unneeded</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/imageModal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

